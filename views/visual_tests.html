<!DOCTYPE html>

<html>
    <head>
        <title>cdcpool tests</title>
        <link href="/stylesheets/test.css" rel="stylesheet" type="text/css" media="all">
        <script src="/javascript/jquery-1.10.2.min.js"></script>
        <script>
            function post_complete(type,test_number,status) {
                if (status == "success") {
                    message = type + ": success";
                    color = "green";
                } else {
                    message = type + " error: " + status;
                    color = "red";
                }
                change_status(test_number,message,color);
            }
            function change_status(test_number,message,color) {
                $("#status_" + test_number).attr("style","color:" + color + ";");
                $("#status_" + test_number).html(message);
            }
            function call_setup(test_number) {
                change_status(test_number,"running setup...","#339900");
                $.post("/a/visual_tests/setup",{ test_number:test_number },function(data,status) {
                    console.log("setup post complete");
                    post_complete("setup",test_number,status);
                });
            }
            function call_cleanup(test_number) {
                change_status(test_number,"running cleanup...","red");
                $.post("/a/visual_tests/cleanup",{ test_number:test_number },function(data,status) {
                    console.log("cleanup post complete");
                    post_complete("cleanup",test_number,status);
                });
            }
        </script>
    </head>
    <body>
        <div class="title">Visual Tests</div>
        <hr>
        <br>
        <div id="instructions">The following are a list of tests that require manual visual inspection<div>
        <br>
        <div id="warning">*** warning ***</div>
        <div id="warning">when clicking the setup button, ensure that the call completes before taking other actions</div>
        <div id="warning">otherwise the database may get into a bad state</div>
        <br>
        <table>
        <thead>
                <td>link</td>
                <td>description</td>
                <td></td>
                <td></td>
                <td>status</td>
        </thead>
        {% for test in data %}
        <tr>
            <td><a href="{{test.link}}" target="_blank">view</a></td>
            <td id="test-description">{{test.description}}</td>
            {% if test.setup %}
                <td><input class="setup" type="button" value="setup" onclick="javascript:call_setup({{test.number}})"></td>
            {% else %}
                <td></td>
            {% endif %}
            {% if test.cleanup %}
                <td><input class="cleanup" type="button" value="cleanup" onclick="javascript:call_cleanup({{test.number}})"></td>
            {% else %}
                <td></td>
            {% endif %}
            <td id="post-status"><span id="status_{{test.number}}"></span></td>
        </tr>
        <tr><td></td><td colspan=3>
            {% for instruction in test.verify %}
                <li>{{instruction}}</li>
            {% endfor %}
        </td>
        </tr>
        <tr><td id="table-line" colspan="5"></td></tr>
        {% endfor %}
        </table>
    </body>
</html>
